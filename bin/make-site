#!/bin/bash
PATH=/bin:/usr/bin

die() {
	echo $* >&2
	exit 1
}

SITE=$1
shift

if test "x$SITE" = x; then
	die "No site name specified. Usage: ./bin/make-site [site-name]"
fi

if echo $SITE | grep -q -e '/'; then
	die "Sites cannot contain slashes. Site given '$SITE'"
fi

if test -d $SITE; then
	die "Site '$SITE' already exists. Remove the $SITE directory to recreate."
fi

# Create a new structure from the existing skeleton
cp -r skeleton $SITE || die "Failed to create $SITE"

# Copy this site to websites, so it will be included
# in generated makefiles
if ! grep -q -x -F "$SITE" websites; then
	echo $SITE >>websites
fi

echo "SITE=$SITE" >>$SITE/site.config

# Finally, indicate that we're ready to go
echo "$SITE is ready for use"
