#!/bin/bash

die() {
    echo $* >&2
    exit 1
}

if [ -e Makefile ]; then
    rm Makefile;
fi

if [ -z "$*" ]; then
    echo "No configuration specified. Configurations available:" >&2
    for f in `ls build/*.config`; do
        echo `basename $f .config` >&2
    done;
    exit 1
fi

BUILDNAME="$*"
BUILD="build/$BUILDNAME.config"
if [ ! -e "$BUILD" ]; then
    echo "No build with name: $BUILDNAME" >&2
    exit 1
fi

echo "# Autogenerated Makefile at `date`"  >Makefile
echo "# DO NOT EDIT THIS FILE!"           >>Makefile
echo                                      >>Makefile
echo "BUILD=$BUILD"                       >>Makefile
echo "BUILDNAME=$BUILDNAME"               >>Makefile
echo "include build/default.config"       >>Makefile
echo "include $BUILD"                     >>Makefile
echo                                      >>Makefile
cat Makefile.in                           >>Makefile

# vim: set et :
